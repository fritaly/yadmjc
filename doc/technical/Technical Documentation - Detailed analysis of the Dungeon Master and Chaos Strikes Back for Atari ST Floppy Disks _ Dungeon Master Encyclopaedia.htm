<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html class="js" dir="ltr" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en"><head>

  
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Technical
Documentation - Detailed analysis of the Dungeon Master and Chaos
Strikes Back for Atari ST Floppy Disks | Dungeon Master Encyclopaedia</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="search" title="DM Encyclopaedia Search" href="http://dmweb.free.fr/sites/all/modules/dmwebmodule/dmwebopensearch.xml" type="application/opensearchdescription+xml">

<link rel="shortcut icon" href="http://dmweb.free.fr/sites/all/themes/dmwebtheme/favicon.ico" type="image/x-icon">
    <link type="text/css" rel="stylesheet" media="all" href="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/node.css">
<link type="text/css" rel="stylesheet" media="all" href="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/defaults.css">
<link type="text/css" rel="stylesheet" media="all" href="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/system.css">
<link type="text/css" rel="stylesheet" media="all" href="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/system-menus.css">
<link type="text/css" rel="stylesheet" media="all" href="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/user.css">
<link type="text/css" rel="stylesheet" media="all" href="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/content-module.css">
<link type="text/css" rel="stylesheet" media="all" href="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/date.css">
<link type="text/css" rel="stylesheet" media="all" href="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/lightbox.css">
<link type="text/css" rel="stylesheet" media="all" href="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/forum.css">
<link type="text/css" rel="stylesheet" media="all" href="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/comment.css">
<link type="text/css" rel="stylesheet" media="all" href="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/style.css">
<link type="text/css" rel="stylesheet" media="print" href="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/print.css">
    <script type="text/javascript" src="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/jquery.js"></script>
<script type="text/javascript" src="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/drupal.js"></script>
<script type="text/javascript" src="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/soundmanager2.js"></script>
<script type="text/javascript" src="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/dmweb.js"></script>
<script type="text/javascript" src="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/lightbox.js"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, { "basePath": "/", "lightbox2": { "rtl": 0, "file_path": "/(\\w\\w/)files", "default_image": "/sites/all/modules/lightbox2/images/brokenimage.jpg", "border_size": "10", "font_color": "000", "box_color": "9E9E9E", "top_position": "", "overlay_opacity": "0.8", "overlay_color": "0C4B54", "disable_close_click": 1, "resize_sequence": "0", "resize_speed": 10, "fade_in_speed": 10, "slide_down_speed": 10, "use_alt_layout": 0, "disable_resize": 0, "disable_zoom": 0, "force_show_nav": 0, "loop_items": 0, "node_link_text": "View Image Details", "node_link_target": 0, "image_count": "Image !current of !total", "video_count": "Video !current of !total", "page_count": "Page !current of !total", "lite_press_x_close": "press \x3ca href=\"#\" onclick=\"hideLightbox(); return FALSE;\"\x3e\x3ckbd\x3ex\x3c/kbd\x3e\x3c/a\x3e to close", "download_link_text": "", "enable_login": false, "enable_contact": false, "keys_close": "c x 27", "keys_previous": "p 37", "keys_next": "n 39", "keys_zoom": "z", "keys_play_pause": "32", "display_image_size": "", "image_node_sizes": "()", "trigger_lightbox_classes": "", "trigger_lightbox_group_classes": "", "trigger_slideshow_classes": "", "trigger_lightframe_classes": "", "trigger_lightframe_group_classes": "", "custom_class_handler": 0, "custom_trigger_classes": "", "disable_for_gallery_lists": 0, "disable_for_acidfree_gallery_lists": true, "enable_acidfree_videos": true, "slideshow_interval": 5000, "slideshow_automatic_start": true, "slideshow_automatic_exit": true, "show_play_pause": true, "pause_on_next_click": false, "pause_on_previous_click": true, "loop_slides": false, "iframe_width": 600, "iframe_height": 400, "iframe_border": 1, "enable_video": 0 } });
//--><!]]>
</script>
    <!--[if lt IE 7]>
      <link type="text/css" rel="stylesheet" media="all" href="/sites/all/themes/dmwebtheme/fix-ie.css" />    <![endif]-->
    <meta name="description" content="A reference site for Dungeon Master, Chaos Strikes Back, Dungeon Master II The Legend Of Skullkeep, Theron's Quest and Dungeon Master Nexus. It provides detailed maps, manuals, lists of items, skills, spells and creatures and much more information.">
    <meta name="robots" content="noodp">
  </head><body class="sidebar-left lightbox-processed">

<!-- Layout -->
  <div id="header-region" class="clear-block"></div>

    <div id="wrapper">
    <div id="container" class="clear-block">

      <div id="header">
        <div id="logo-floater">
        <h1><a href="http://dmweb.free.fr/" title="Dungeon Master Encyclopaedia"><img src="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/logo.png" alt="Dungeon Master Encyclopaedia" id="logo"><span>Dungeon Master Encyclopaedia</span></a></h1>        </div>

                  <ul class="links primary-links"><li class="menu-54 first"><a href="http://dmweb.free.fr/?q=view/CategoryBrowser">Content Categories</a></li>
<li class="menu-37"><a href="http://dmweb.free.fr/?q=forum">Site Forum</a></li>
<li class="menu-36 last"><a href="http://www.dungeon-master.com/forum">dungeon-master.com Forums</a></li>
</ul>                                  
      </div> <!-- /header -->

              <div id="sidebar-left" class="sidebar">
          <div class="block block-theme"><form action="/?q=node/1429" accept-charset="UTF-8" method="post" id="search-theme-form">
<div><div id="search" class="container-inline">
  <div class="form-item" id="edit-search-theme-form-1-wrapper">
 <label for="edit-search-theme-form-1">Search this site: </label>
 <input maxlength="128" name="search_theme_form" id="edit-search-theme-form-1" size="15" value="" title="Enter the terms you wish to search for." class="form-text" type="text">
</div>
<input name="op" id="edit-submit" value="Search" class="form-submit" type="submit">
<input name="form_build_id" id="form-fa2fe4a59c3a89ad961e339884b64965" value="form-fa2fe4a59c3a89ad961e339884b64965" type="hidden">
<input name="form_id" id="edit-search-theme-form" value="search_theme_form" type="hidden">
</div>

</div></form>
<small><a href="http://dmweb.free.fr/?q=search">More search options</a></small></div>          <div id="block-user-1" class="clear-block block block-user">

  <h2>Navigation</h2>

  <div class="content"><ul class="menu"><li id="the_games_series" class="expanded first"><a href="http://dmweb.free.fr/?q=node/1168">The games series</a><ul class="menu"><li id="dungeon_master" class="leaf first"><a href="http://dmweb.free.fr/?q=node/247">Dungeon Master</a></li>
<li id="chaos_strikes_back" class="leaf"><a href="http://dmweb.free.fr/?q=node/249">Chaos Strikes Back</a></li>
<li id="dungeon_master_ii" class="leaf"><a href="http://dmweb.free.fr/?q=node/250">Dungeon Master II</a></li>
<li id="therons_quest" class="leaf"><a href="http://dmweb.free.fr/?q=node/252">Theron's Quest</a></li>
<li id="dungeon_master_nexus" class="leaf last"><a href="http://dmweb.free.fr/?q=node/251">Dungeon Master Nexus</a></li>
</ul></li>
<li id="related_products" class="leaf"><a href="http://dmweb.free.fr/?q=taxonomy/term/85%2B86%2B55" title="">Related products</a></li>
<li id="ftl_games" class="leaf"><a href="http://dmweb.free.fr/?q=node/100">FTL Games</a></li>
<li id="fan_made" class="expanded"><a href="http://dmweb.free.fr/?q=node/870">Fan made</a><ul class="menu"><li id="clones" class="leaf first"><a href="http://dmweb.free.fr/?q=view/Clones">Clones</a></li>
<li id="custom_dungeons" class="expanded"><a href="http://dmweb.free.fr/?q=view/CustomDungeons">Custom Dungeons</a><ul class="menu"><li id="reviews" class="leaf last"><a href="http://dmweb.free.fr/?q=view/CustomDungeonsReviews">Reviews</a></li>
</ul></li>
<li id="tools" class="leaf last"><a href="http://dmweb.free.fr/?q=view/Tools">Tools</a></li>
</ul></li>
<li id="faq" class="leaf"><a href="http://dmweb.free.fr/?q=view/FAQ">FAQ</a></li>
<li id="technical_documentation" class="leaf"><a href="http://dmweb.free.fr/?q=taxonomy/term/39">Technical Documentation</a></li>
<li id="wiki" class="leaf"><a href="http://dmweb.free.fr/?q=view/Wiki">Wiki</a></li>
<li id="links" class="leaf"><a href="http://dmweb.free.fr/?q=view/Links">Links</a></li>
<li id="site_news" class="leaf"><a href="http://dmweb.free.fr/?q=tracker">Site news</a></li>
<li id="content_categories" class="leaf"><a href="http://dmweb.free.fr/?q=view/CategoryBrowser">Content Categories</a></li>
<li id="contact" class="leaf"><a href="http://dmweb.free.fr/?q=node/204">Contact</a></li>
<li id="news_feed" class="leaf"><a href="http://dmweb.free.fr/?q=node/feed" title="News feed">News feed</a></li>
<li id="windows_live_alerts" class="leaf"><a href="http://signup.alerts.live.com/alerts/login.do?PINID=41190349&amp;returnURL=http://dmweb.free.fr/">Windows Live Alerts</a></li>
<li id="log_in" class="leaf last"><a href="http://dmweb.free.fr/?q=user">Log in</a></li>
</ul></div>
</div>
        </div>
      
      <div id="center"><div id="squeeze"><div class="right-corner"><div class="left-corner">
          <div class="breadcrumb"><a href="http://dmweb.free.fr/">Home</a> › <a href="http://dmweb.free.fr/?q=node">content</a></div>                    <div id="quickmenu"><form id="ContentCategories"><h2>Content Categories</h2><table><tbody><tr class="odd"><td><input value="Show" id="ContentCategoriesSubmit" type="button"></td> <td>Click
a category to display the list of pages in this category. Check several
categories and click 'Show' to display the list of pages in all
selected categories. Click anywhere outside this category list to hide
it.</td></tr><tr class="even"><th>Games</th><td><input name="C17" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/17">Dungeon&nbsp;Master</a> <input name="C22" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/22">Chaos&nbsp;Strikes&nbsp;Back</a> <input name="C33" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/33">Dungeon&nbsp;Master&nbsp;II</a> <input name="C34" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/34">Theron's&nbsp;Quest</a> <input name="C35" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/35">Dungeon&nbsp;Master&nbsp;Nexus</a> </td></tr><tr class="odd"><th>Platforms</th><td><input name="C21" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/21">Amiga</a> <input name="C24" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/24">Apple&nbsp;IIGS</a> <input name="C20" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/20">Atari&nbsp;ST</a> <input name="C26" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/26">FM-Towns</a> <input name="C59" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/59">IBM&nbsp;PS/V</a> <input name="C29" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/29">Macintosh</a> <input name="C28" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/28">PC</a> <input name="C27" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/27">PC-9801&nbsp;/&nbsp;PC-9821</a> <input name="C30" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/30">Sega&nbsp;CD&nbsp;/&nbsp;Mega&nbsp;CD</a> <input name="C32" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/32">Sega&nbsp;Saturn</a> <input name="C25" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/25">Super&nbsp;NES&nbsp;/&nbsp;Super&nbsp;Famicom</a> <input name="C31" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/31">TurboGrafx&nbsp;/&nbsp;PC&nbsp;Engine</a> <input name="C23" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/23">X68000</a> </td></tr><tr class="even"><th>Other</th><td><input name="C40" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/40">Champions</a> <input name="C57" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/57">Creatures</a> <input name="C41" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/41">Items</a> <input name="C44" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/44">Spells</a> <input name="C42" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/42">Maps</a> <input name="C45" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/45">Hints</a> <input name="C46" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/46">Walkthroughs</a> <input name="C56" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/56">Reviews</a> <input name="C43" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/43">Screenshots</a> <input name="C18" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/18">Scans</a> <input name="C19" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/19">Manuals</a> <input name="C47" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/47">Downloads</a> <input name="C49" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/49">Music</a> <input name="C58" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/58">Videos</a> <input name="C84" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/84">Advertisements</a> <input name="C85" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/85">Related&nbsp;products</a> <input name="C86" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/86">Audio&nbsp;CD</a> <input name="C55" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/55">Hint&nbsp;books</a> <input name="C87" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/87">FTL&nbsp;Games</a> <input name="C74" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/74">Interviews</a> <input name="C36" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/88">Clones (Traditional)</a> <input name="C36" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/89">Clones (Modern)</a> <input name="C81" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/81">CSBwin</a> <input name="C80" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/80">Tools</a> <input name="C39" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/39">Technical&nbsp;Documentation</a> <input name="C54" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/54">News</a> <input name="C50" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/50">PDF</a> <input name="C52" type="checkbox"><a href="http://dmweb.free.fr/?q=taxonomy/term/52">Web&nbsp;site</a> </td></tr></tbody></table></form></div>
                              <div style="display: block;" id="toc">
          <div id="toc-title">Contents</div>
          <div id="toc-content"><div class="toc-h3"><a href="#toc1">Overview</a></div><div class="toc-h3"><a href="#toc5">Technical background</a></div><div class="toc-h4"><a href="#toc6">Some definitions</a></div><div class="toc-h4"><a href="#toc8">Organizing data on the disk</a></div><div class="toc-h4"><a href="#toc12">Storing binary data using magnetic states</a></div><div class="toc-h4"><a href="#toc19">Reading and writing data</a></div><div class="toc-h4"><a href="#toc22">Encoding data</a></div><div class="toc-h4"><a href="#toc26">Synchronizing the FDC</a></div><div class="toc-h4"><a href="#toc31">Separating data bits and clock bits</a></div><div class="toc-h4"><a href="#toc35">Track layout</a></div><div class="toc-h4"><a href="#toc40">Floppy disk formats</a></div><div class="toc-h3"><a href="#toc43">Detailed structure of the games' floppy disk</a></div><div class="toc-h4"><a href="#toc44">General layout</a></div><div class="toc-h4"><a href="#toc46">Track 0, Sector 1: Boot sector</a></div><div class="toc-h4"><a href="#toc55">Track 0, Sectors 2 to 6: File system</a></div><div class="toc-h4"><a href="#toc61">Track 0, Sector 7: Serial number and protection with fuzzy bits</a></div><div class="toc-h4"><a href="#toc82">Track 0, Sector 247: Protection with a non standard sector number</a></div><div class="toc-h3"><a href="#toc86">Description of the boot process</a></div><div class="toc-h3"><a href="#toc88">References</a></div><div class="toc-h3"><a href="#toc90">Credits</a></div><div class="toc-h3"><a href="#toc92">History of this document</a></div></div>
          </div>
                    <h2>Technical Documentation - Detailed analysis of the Dungeon Master and Chaos Strikes Back for Atari ST Floppy Disks</h2>                                                  <div class="clear-block">
            <div id="node-1429" class="node">



      <span class="submitted">Sun, 2009-01-18 21:05 — Christophe Fontanel</span>
  
  <div class="content clear-block">
    <p>Version 1.1, February 14, 2009<br>
by Christophe Fontanel</p>
<h3 id="toc1">Overview</h3>
<p>This document provides a detailed description of the floppy disk
used by Dungeon Master and Chaos Strikes Back for Atari ST. All
versions of Dungeon Master and Chaos Strikes Back for Atari ST were
studied:</p>
<ul>
<li>Dungeon Master version 1.0 English (1987-12-08)</li>
<li>Dungeon Master version 1.0 English (1987-12-11)</li>
<li>Dungeon Master version 1.1 English</li>
<li>Dungeon Master version 1.2 English</li>
<li>Dungeon Master version 1.2 German</li>
<li>Dungeon Master version 1.3 French</li>
<li>Chaos Strikes Back version 2.0 English (Game Disk)</li>
<li>Chaos Strikes Back version 2.1 English (Game Disk)</li>
</ul>
<p>The first part of the document contains general information
explaining how data is stored on a floppy disk and how it is read. This
technical information is required in order to fully understand the
second part of the document that describes the contents of the game's
floppy disk and particularly the sectors used by the copy protection
scheme.</p>
<h3 id="toc5">Technical background</h3>
<h4 id="toc6">Some definitions</h4>
<p><strong>Floppy disk</strong>: A data storage media in the shape of a
disk whose surface is coated with a magnetic material on both sides.
You can think of this coating as a huge number of tiny magnets that can
be oriented as desired. Each magnet creates a small magnetic field and
has a north pole and a south pole. Identical poles repel themselves
while different poles attract themselves.<br>
<a href="http://dmweb.free.fr/files/TechDoc-FloppyDisk.png" class="internal lightbox-processed" rel="lightbox" alt="Floppy Disk" title="Floppy Disk"><img src="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/TechDoc-FloppyDiskThumbnail.png" alt="Floppy Disk" title="Floppy Disk" class="thumbnail" height="100" width="58"></a><br>
<strong>Floppy disk drive</strong>: The electromechanical device used
to read and write data on floppy disks. Its main components include a
motor to rotate the disk, a head to read/write data to disks and a
second step by step motor to move the head across the disk.<br>
<a href="http://dmweb.free.fr/files/TechDoc-FloppyDiskDrive.jpg" class="internal lightbox-processed" rel="lightbox" alt="Floppy Disk Drive" title="Floppy Disk Drive"><img src="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/TechDoc-FloppyDiskDriveThumbnail.jpg" alt="Floppy Disk Drive" title="Floppy Disk Drive" class="thumbnail" height="100" width="99"></a><br>
<strong>Floppy disk controller (FDC)</strong>: An electronic chip
connected to the floppy disk drive and designed to manage it. In a
computer, programs can only talk with the FDC and never directly with
the floppy disk drive.</p>
<h4 id="toc8">Organizing data on the disk</h4>
<p>The physical surface of a floppy disk is homogeneous. However, this
surface is logically divided into smaller parts to make it easier to
read and write small amounts of data at a time. First, the surface is
divided into tracks. A track is a circular area on the floppy disk. On
figure 1, the orange area represents a track. Tracks are numbered
starting at 0 and the first track is on the outer edge of the surface.
The innermost track depicted in green represents the last track.<br>
Each track is divided into smaller parts called sectors. On figure 1,
the red area represents a sector on track 0, the first track. The
yellow area represents another sector. While the actual length of these
two sectors are very different (the outermost being much longer), every
sector contains the same amount of data. Because the drive rotates the
floppy disk at a constant angular speed, the drive's head will spend
the same amount of time above all sectors, no matter which track they
are part of.<br>
<strong>Figure 1</strong><br>
<a href="http://dmweb.free.fr/files/TechDoc-FloppyDiskStructure.png" class="internal lightbox-processed" rel="lightbox" alt="Floppy Disk Structure" title="Floppy Disk Structure"><img src="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/TechDoc-FloppyDiskStructureThumbnail.png" alt="Floppy Disk Structure" title="Floppy Disk Structure" class="thumbnail" height="97" width="100"></a></p>
<p>A sector is the smallest area that can be read or written: if you
want to read a single byte of data from the floppy disk, you need to
read the whole sector and then extract the byte you want from this
sector data. Similarly, if you want to write a single byte of data to
the floppy disk, you must first read the content of the sector where
the byte will be written, modify the byte you want in memory and then
write back the whole sector.</p>
<p>When the drive starts to write data to the floppy disk, there is
some imprecision to where exactly it will start. In order to avoid any
overlap while writing a particular sector, there are areas called
'gaps' between each sector and also between the beginning and end of a
track. These gaps provide some tolerance for the start and end
locations of sectors. Gaps do not contain any useful user data.</p>
<h4 id="toc12">Storing binary data using magnetic states</h4>
<p>Floppy disks are designed to record digital data, which are series
of bits of information ('0' and '1' values). For that purpose, only two
different magnetic states are required (contrary to analog recording
like on audio tapes).<br>
The floppy disk surface is virtually divided into small areas. When all
the magnets in an area are oriented in the same way, their individual
magnetic fields combine themselves to produce a stronger and
significant magnetic field, also called a 'magnetic flux'. Information
is stored on the disk by creating series of areas where all magnets are
oriented in the same way, thus creating two types of magnetized areas:
'north poles areas' or 'south poles areas'. Binary data is stored using
these two states, but they do not directly map to bit values (zeros and
ones). In fact, each bit is stored using two adjacent magnetized areas,
forming what is called a 'bit cell':</p>
<ul>
<li>Two areas with different magnetizations (a north pole and a south
pole, in any order) represent a '1' bit. Such a bit cell is said to
contain a 'flux reversal'.</li>
<li>Two areas with identical magnetization (two north poles or two
south poles) represent a '0' bit. Such a bit cell does not contain a
'flux reversal'.</li>
</ul>
<p>This scheme is necessary because when reading information from the
floppy disk, the drive is not able to detect the magnetization of an
area as a north pole or a south pole. It can only detect flux reversals.<br>
As a result, data on a track is stored as regions of opposite
magnetization, which is illustrated on figure 1 by the small zoomed
portion of a sector.</p>
<p>Changing the orientation of the magnets (in order to write
information to the disk) or detecting flux reversals (in order to read
information from the disk) relies on the physical phenomenon named
'electromagnetic induction' that has two aspects:</p>
<ul>
<li>A changing magnetic field will create an electric current in a
nearby electric circuit. Note that a constant magnetic field will not
create any current. This is why only flux reversals can be detected and
not the absolute magnetization of the surface.</li>
<li>The flow of electicity in an electric circuit produces a magnetic field.</li>
</ul>
<p>These two aspects are used in the head of a floppy disk drive. The
head contains a small coil and is the part of the disk drive that is
the closest to the disk surface (without touching it) and allows
reading and writing.</p>
<h4 id="toc19">Reading and writing data</h4>
<p>In order to write data to the disk, the computer sends binary data
that is converted to a current in the head coil. This current is
reversed when a '1' bit is sent and remains the same when a '0' bit is
sent. The current in the coil produces a magnetic field whose direction
depends on the way the current is flowing in the head. The magnets on
the disk surface will then change their orientation to align with the
magnetic field produced by the head coil. By using the appropriate
electrical signal, it is thus possible to create areas on the disk
oriented in one way of the other. The shape of the writing current in
the head is represented on figure 2.</p>
<p>In order to read data from the disk, the head is not powered. While
moving above the disk surface, the flux reversals on the media will
induce electric pulses in the head coil. The presence of an electric
pulse is translated to a '1' bit and the absence of pulse is translated
to a '0' bit. The shape of the reading current in the head is
represented on figure 2.<br>
Detecting a '1' bit is fairly easy as a pulse is generated, but
detecting a '0' bit requires some timing: the floppy disk controller
has to wait for some time before concluding that no flux reversal
occured when one could have occured. Also, if there was a large number
of consecutive '0' bits written on the disk, it would be difficult for
the FDC to accurately count these bits. This is why the FDC requires an
accurate synchronization with the data flow coming from the head of the
floppy drive. This requirement is achieved by two things described in
the following sections: an encoding scheme for data written to the disk
and a system inside the FDC so that it automatically synchronizes its
clock with the electrical pulses it receives while reading from the
floppy disk drive.</p>
<h4 id="toc22">Encoding data</h4>
<p>Floppy disks on Atari ST use an encoding named 'Modified Frequency
Modulation' (MFM). This simple encoding is used to prevent long series
of '0' bits from being written to the floppy disk. In MFM encoding, the
stream of data bits that you want to write to the floppy disk is
modified by inserting and additional bit, called a clock bit, between
each pair of data bits. The value of a clock bit depends on the values
of the two data bits around it: if both data bits are '0', then the
clock bit is set to '1'. Otherwise, the clock bit is set to '0'.<br>
This encoding ensures that there are no sequences of more than three consecutive '0' bits.<br>
Figure 2 illustrates the MFM encoding of two data bytes of value $68 by
highlighting the data bits and clock bits with different colors.</p>
<p>Note: this MFM encoding is also used on other computers like on PC. There are also other encodings like FM or GCR.</p>
<p><strong>Figure 2</strong><br>
<a href="http://dmweb.free.fr/files/TechDoc-BitCells.png" class="internal lightbox-processed" rel="lightbox" alt="Bit Cells" title="Bit Cells"><img src="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/TechDoc-BitCellsThumbnail.png" alt="Bit Cells" title="Bit Cells" class="thumbnail" height="39" width="100"></a></p>
<h4 id="toc26">Synchronizing the FDC</h4>
<p>The FDC needs a clock so that it knows the rate at which it should
output data bits interpreted from the electrical signal it receives
from the floppy disk drive. For this purpose, it uses an 'inspection
window' which is a time frame during which the FDC waits for an
electrical pulse (a flux reversal) to occur.</p>
<p>The <em>size</em> of a bit cell it is the amount of time it takes
for the drive's head to move across a bit cell on the disk. On Atari
ST, the floppy disk rotates under the head at a constant angular speed
of about 300rpm (rotations per minute) but there can be small speed
differences from drive to drive (a more or less 1% tolerance).<br>
For MFM disks on Atari ST, the bit cell size is standard at 2µs
(microseconds), but the small possible variations of disk rotation
speed means that the bit cell size can appear shorter or longer when
read by the FDC.</p>
<p>Note: In this document, a <em>bit cell</em> refers to an area on the
disk surface that either contains a flux reversal or does not contain
one. Using this definition, an MFM bit cell is 2µs wide. In some other
documents, the term <em>bit cell</em> may be used to refer to a bit of
useful user data, each of which is stored on the disk as the data bit
itself and the additional clock bit. With this alternate definition, an
MFM bit cell is 4µs wide because it contains both a data bit and a
clock bit.</p>
<p>The FDC contains a part called a 'Phase-Locked Loop' (PLL) which is
responsible for automatically adjusting the inspection window to the
input signal. When pulses are found, the PLL automatically adjusts the
size and position of the inspection window so that pulses occur right
in the middle of the inspection window.<br>
In a perfect case, the inspection window would be exactly 2µs
(microseconds) and each pulse would occur exactly in the middle of the
inspection window.<br>
When adjusted, the FDC monitors the electrictal signal for a 2µs time
frame. If a pulse occurs during this time frame, the FDC interprets it
as a '1' bit and outputs it. If no pulse occurs during this time frame,
the FDC interprets it as a '0' bit and outputs it.<br>
The result is a raw sequence of bits. The next step is to separate the data bits from the clock bits.</p>
<h4 id="toc31">Separating data bits and clock bits</h4>
<p>This task is performed by a part of the FDC called the 'data
separator' and is achieved by searching for a very specific bit pattern
in the raw sequence of bits. This pattern is called a 'synchronization
mark' as it indicates to the data separator where to start its job.
This mark is written using a special command of the FDC. It cannot
appear in normal user data and because the mark violates the MFM
encoding rule: it contains a '0' clock bit inserted between two '0'
data bits (note that it does not violates the rule of the 3 maximum
consecutive '0' bits). This mark is called A1 because it is similar to
the encoding of the hexadecimal value $A1. The mark is also noted $4489
as it is the exact value written to disk when including data bits and
clock bits.</p>
<pre>Binary representation of $A1 byte: 1 0 1 0 0 0 0 1
MFM encoded representation of $A1: 100010010101001
The synchronization mark value is: 100010010<strong><em>0</em></strong>01001 (which is $4489 in hexadecimal)</pre><p>The MFM encoded representation is the value written to the disk when writing $A1 as part of normal data.<br>
The synchronization mark value is written to the disk when using the
appropriate special FDC command. When reading this bit sequence, the
FDC will know it is a synchronization mark because one bit (the one in
bold) is a '0' instead of the '1' it would be for normal MFM encoded
data.<br>
Once the synchronization mark has been found, it is easy for the FDC to
tell which bits are the clock bits and which ones are the data bits.</p>
<h4 id="toc35">Track layout</h4>
<p>The track layout defines the logical structure of a track. Each
track contains an 'index mark' to indicate the beginning of the track.
This index mark is preceded by a gap and synchronization marks. Gaps
are locations where no useful data is written. This data is used to
help the PLL synchronization process and also to avoid any overlap
between sectors when overwriting a single sector (because there is an
imprecision about where the writing will start exactly).<br>
Following this index mark are the sectors in the track. Each sector
contains a header field and a data field. The sector header field is
preceded by a gap and synchronization marks. It contains the following
information about the sector:</p>
<ul>
<li>the track number</li>
<li>the side number (0 or 1 for the two possible sides of the floppy disk)</li>
<li>the sector number (sector numbering starts at 1, unlike track numbering that starts at 0)</li>
<li>the size of the sector. The possible sizes are 128 bytes, 256
bytes, 512 bytes and 1024 bytes. 512 bytes is the standard sector size
on Atari ST.</li>
<li>a CRC (Cyclic Redundancy Check) value used to detect errors in the sector header field.</li>
</ul>
<p>The sector data field is also preceded by a gap and synchronization marks. It contains the following information:</p>
<ul>
<li>the 512 bytes of user data</li>
<li>a CRC value used to detect errors in the sector data field.</li>
</ul>
<h4 id="toc40">Floppy disk formats</h4>
<p>There are many possible floppy disk formats that use varying numbers
of tracks, sectors per track and sector sizes. The format of a floppy
disk is defined when the disk is formated. When a floppy disk is
formated, each track is written at once (not sector by sector), thus
defining the number of sectors and their size, the size of gaps, etc.
This operation is called low-level formating. High-level formating
means installing a file system on the floppy disk. Usually low and high
level formating are performed together.</p>
<p>A standard Atari ST floppy disk has two sides, 80 tracks per side
(numbered 0 to 79), 9 sectors per track (numbered 1 to 9) and 512 bytes
per sector. The resulting storage capacity is 2 sides x 80 tracks x 9
sectors per track x 512 bytes per sector = 737280 Bytes = 720 KB. It is
possible to store 10 or even 11 sectors per track by reducing the size
of gaps.</p>
<h3 id="toc43">Detailed structure of the games' floppy disk</h3>
<h4 id="toc44">General layout</h4>
<p>All versions of Dungeon Master and Chaos Strikes Back for Atari ST
use the same floppy disk format. The format is similar to the standard
floppy disk format but with 10 sectors per track instead of 9 in order
to store more data on the floppy disk. However, they use only one side
of the floppy disk (single sided certified floppy disks were cheaper
back at that time). The resulting storage capacity is: 1 side x 80
tracks x 10 sectors per track x 512 bytes per sector = 409600 Bytes =
400 KB.<br>
This storage capacity is fully used by the game as all sectors contain
data. It would have not been possible to store all the game data on a
single side of a standard Atari ST floppy disk that could only contain
360 KB.<br>
While non standard, this format should not be considered a part of the
game's copy protection scheme because there is no technical difficulty
in copying such a disk format.<br>
Track 0 contains a standard Atari ST boot sector and file system as
well as two special sectors used by the copy protection scheme. The
last two sectors in track 0 and all sectors in other tracks are used to
store the game's files. These last sectors will not be described
further in this document as they are completely standard and just
contain the game's program and data files.</p>
<h4 id="toc46">Track 0, Sector 1: Boot sector</h4>
<p>This sector is identical in all versions of Dungeon Master and Chaos Strikes Back for Atari ST.<br>
When the computer starts, the BIOS performs some hardware initialization, then it tries to boot from the floppy disk.<br>
For that purpose, it will load in memory the first sector of the first track (sector 1 of track 0).<br>
The Atari ST BIOS ensures that the floppy disk is bootable. This check
is performed by computing a checksum on the 512 bytes of the boot
sector data. This checksum algorithm adds the 256 words in the boot
sector. If the result is $1234 then the BIOS assumes that the sector is
bootable.<br>
The sector is then executed starting at offset 0.</p>
<p>The floppy disk contains a standard Atari ST boot sector including the default loader code. The boot sector contains:</p>
<ul>
<li>A branch instruction to the beginning of the Loader code.</li>
<li>Data describing the floppy disk format.</li>
<li>The Loader configuration: instructs the loader code to load and execute the file named SWOOSH.IMG.</li>
<li>The Loader code.</li>
<li>Padding $00 bytes until the end of the sector.</li>
<li>A last word which value is computed so that the checksum of the sector is $1234.</li>
</ul>
<p>The loader is configured to load in memory the file named SWOOSH.IMG and then run this program.<br>
The code in the boot sector will load in memory the appropriate sectors
containing the File Allocation Table (FAT) and the root directory
listing. It will use this data to search for the SWOOSH.IMG file. The
file is then loaded in memory at address $40000. The program is then
executed starting at address $40000.</p>
<p>Here is an hexadecimal dump of the data in this sector:</p>
<pre>Offset(h) 00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F

00000000  60 38 4C 6F 61 64 65 72 00 00 00 00 02 02 01 00  `8Loader........
00000010  02 10 00 24 03 F8 02 00 0A 00 01 00 00 00 00 00  ...$.ø..........
00000020  00 00 00 00 00 00 00 04 00 00 00 00 00 00 53 57  ..............SW
00000030  4F 4F 53 48 20 20 49 4D 47 00 70 07 32 3C 07 77  OOSH  IMG.p.2&lt;.w
00000040  48 E7 C0 00 3F 3C 00 25 4E 4E 54 8F 4C DF 00 03  HçÀ.?&lt;.%NNT.Lß..
00000050  20 7C FF FF 82 40 30 81 04 41 01 11 51 C8 FF E2   |ÿÿ‚@0..A..QÈÿâ
00000060  20 7C FF FF 82 40 70 0F 42 58 51 C8 FF FC 33 FA   |ÿÿ‚@p.BXQÈÿü3ú
00000070  FF AE 00 00 04 82 3F 39 00 00 04 46 3F 3C 00 07  ÿ®...‚?9...F?&lt;..
00000080  4E 4D 58 4F 4A 80 67 00 00 F6 2A 40 41 FA FF 9C  NMXOJ€g..ö*@Aúÿœ
00000090  4A 90 66 06 20 B9 00 00 04 32 30 2D 00 08 E1 48  J.f. ¹...20-..áH
000000A0  D0 80 38 40 D9 FA FF 84 30 3A FF 76 67 10 3C 3A  Ð€8@Ùúÿ„0:ÿvg.&lt;:
000000B0  FF 72 38 3A FF 70 26 7A FF 6E 60 00 00 B4 3C 2D  ÿr8:ÿp&amp;zÿn`..´&lt;-
000000C0  00 0A 38 2D 00 08 D8 6D 00 06 26 7A FF 5E 61 00  ..8-..Øm..&amp;zÿ^a.
000000D0  00 B0 66 00 00 AA 20 4C 30 2D 00 06 E1 48 E3 48  .°f..ª L0-..áHãH
000000E0  41 F0 00 00 43 FA FF 48 90 FC 00 20 B1 CC 6D 00  Að..CúÿH.ü. ±Ìm.
000000F0  00 8E 70 0A 12 30 00 00 B2 31 00 00 66 EA 51 C8  .Žp..0..²1..fêQÈ
00000100  FF F4 7E 00 1E 28 00 1B E1 4F 1E 28 00 1A 2C 7A  ÿô~..(..áO.(..,z
00000110  FF 1A 26 7A FF 12 42 84 0C 47 0F F0 6C 52 36 07  ÿ.&amp;zÿ.B„.G.ðlR6.
00000120  55 43 C6 ED 00 02 D6 6D 00 0C 0C 44 00 40 6C 08  UCÆí..Öm...D.@l.
00000130  4A 44 67 0E B6 45 67 10 61 46 66 42 E1 8C E3 8C  JDg.¶Eg.aFfBáŒãŒ
00000140  D7 C4 3C 03 3A 03 42 84 D8 6D 00 02 DA 6D 00 02  ×Ä&lt;.:.B„Øm..Úm..
00000150  34 07 E2 4A D4 47 12 36 20 01 E1 49 12 36 20 00  4.âJÔG.6 .áI.6 .
00000160  08 07 00 00 67 02 E8 49 02 41 0F FF 3E 01 60 A8  ....g.èI.A.ÿ&gt;.`¨
00000170  4A 44 67 04 61 0A 66 06 2F 3A FE AC 4E 75 60 FE  JDg.a.f./:þ¬Nu`þ
00000180  3F 39 00 00 04 46 3F 06 3F 04 2F 0B 42 67 3F 3C  ?9...F?.?./.Bg?&lt;
00000190  00 04 4E 4D DE FC 00 0E 4A 40 4E 75 00 00 00 00  ..NMÞü..J@Nu....
000001A0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
000001B0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
000001C0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
000001D0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
000001E0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
000001F0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 24 7D  ..............$}</pre><p>
Detailed content of the boot sector:</p>
<table>
<tbody><tr>
<th>Offset</th>
<th>Size</th>
<th>Values</th>
<th>Notes</th>
</tr>
<tr class="odd">
<td>000</td>
<td>2</td>
<td>60 38</td>
<td> BRA.S instruction to branch to the loader code at offset $3A ($38 bytes forward).</td>
</tr>
<tr class="even">
<td>002</td>
<td>6</td>
<td>4C 6F 61 64 65 72 ('Loader' string)</td>
<td></td>
</tr>
<tr class="odd">
<td>008</td>
<td>3</td>
<td>00 00 00</td>
<td>Volume serial number.</td>
</tr>
<tr class="even">
<td>00B</td>
<td>2</td>
<td>00 02 (512)</td>
<td>Number of bytes per sector (Little endian word).</td>
</tr>
<tr class="odd">
<td>00D</td>
<td>1</td>
<td>02 (2)</td>
<td>Number of sectors per cluster.</td>
</tr>
<tr class="even">
<td>00E</td>
<td>2</td>
<td>01 00 (1)</td>
<td>Number of reserved sectors (Little endian word).</td>
</tr>
<tr class="odd">
<td>010</td>
<td>1</td>
<td>02 (2)</td>
<td>Number of File Allocation Tables (FAT).</td>
</tr>
<tr class="even">
<td>011</td>
<td>2</td>
<td>10 00 (16)</td>
<td>Number of entries in the root directory (Little endian word). Each
entry is 32 bytes so 16 entries occupy exactly a sector (512 bytes).</td>
</tr>
<tr class="odd">
<td>013</td>
<td>2</td>
<td>24 03 (804)</td>
<td>Number of sectors on media. This number of sectors is incorrect and should be 800 (80 tracks of 10 sectors).</td>
</tr>
<tr class="even">
<td>015</td>
<td>1</td>
<td>F8</td>
<td>Media descriptor.</td>
</tr>
<tr class="odd">
<td>016</td>
<td>2</td>
<td>02 00 (2)</td>
<td>Number of sectors per FAT (Little endian word).</td>
</tr>
<tr class="even">
<td>018</td>
<td>2</td>
<td>0A 00 (10)</td>
<td>Number of sectors per track (Little endian word).</td>
</tr>
<tr class="odd">
<td>01A</td>
<td>2</td>
<td>01 00 (1)</td>
<td>Number of sides on media (Little endian word).</td>
</tr>
<tr class="even">
<td>01C</td>
<td>2</td>
<td>00 00 (0)</td>
<td>Number of hidden sectors (Little endian word).</td>
</tr>
<tr class="odd">
<td>01E</td>
<td>2</td>
<td>00 00 (0)</td>
<td>A word value that is copied to the system variable named '_cmdload' (Big endian word).</td>
</tr>
<tr class="even">
<td>020</td>
<td>2</td>
<td>00 00 (0)</td>
<td>Load mode (Big endian word). 0 instructs the loader to load a file
by its name and using the filesystem. Other values instruct the loader
to load a sequence of sectors without refering to the filesystem.</td>
</tr>
<tr class="odd">
<td>022</td>
<td>2</td>
<td>00 00 (0)</td>
<td>First sector to read (Big endian word). Only used when Load mode is not 0.</td>
</tr>
<tr class="even">
<td>024</td>
<td>2</td>
<td>00 00 (0)</td>
<td>Number of sectors to read (Big endian word). Only used when Load mode is not 0.</td>
</tr>
<tr class="odd">
<td>026</td>
<td>4</td>
<td>00 04 00 00</td>
<td>Load address (Big endian double word). Memory address where the file or sectors will be loaded.</td>
</tr>
<tr class="even">
<td>02A</td>
<td>4</td>
<td>00 00 00 00</td>
<td>FAT address (Big endian double word). Memory address where the FAT
and root directory data will be loaded. The value $00000000 will
automatically select an appropriate address.</td>
</tr>
<tr class="odd">
<td>02E</td>
<td>11</td>
<td>53 57 4F 4F 53 48 20 20 49 4D 47 'SWOOSH&nbsp;&nbsp;IMG' string.</td>
<td>File name and extension (8.3 name without the '.'). Only used when Load mode is 0.</td>
</tr>
<tr class="even">
<td>039</td>
<td>1</td>
<td>00</td>
<td>Reserved.</td>
</tr>
<tr class="odd">
<td>03A</td>
<td>n</td>
<td>-</td>
<td>Boot code (padded with 00 bytes at the end to fill the whole sector).</td>
</tr>
<tr class="even">
<td>1FE</td>
<td>2</td>
<td>24 7D</td>
<td>Word value computed so that the checksum of the boot sector is $1234.</td>
</tr>
</tbody></table>
<h4 id="toc55">Track 0, Sectors 2 to 6: File system</h4>
<p>The floppy disk is formatted using the FAT12 file system that is
used on standard Atari ST floppy disks. The same file system is used on
IBM PC floppy disks.<br>
FAT file systems manage disk space in logical chunks called 'clusters'. A cluster is a set of one or more sectors.<br>
Each file on the disk is stored in one or more clusters. A cluster is
only affected to one file at a time which means that there can be
unused (wasted) space at the end of a cluster.<br>
There is a directory structure that contains an entry for each file.
Such an entry stores the file name, the size, the date and time of last
modification and the ID of the first cluster used by the file. The
other clusters used by the file can be determined by parsing the FAT
which is a table with an entry for each cluster on the disk. Each entry
in this table contains either the ID of the next cluster of the file,
or a special value marking the last cluster of the file.<br>
For robustness, the FAT is duplicated on two separate locations on the
disk to ensure that files can be read even if one sector used to store
the FAT itself becomes unreadable.<br>
On the Dungeon Master and Chaos Strikes Back for Atari ST floppy disks:<br>
Sectors 2 and 3 store the first FAT<br>
Sectors 4 and 5 store the second FAT (an exact copy of the first FAT)<br>
Sector 6 stores the root directory. There can be 16 entries (16 files) in the root directory.</p>
<p>Here is a list of the files that can be found on all versions of the games:</p>
<table>
<tbody><tr>
<th rowspan="2">File name</th>
<th rowspan="2">Clusters used</th>
<th colspan="8">Size and Date/Time</th>
</tr>
<tr>
<th>DM 1.0 EN<br>
(1987-12-08)</th>
<th>DM 1.0 EN<br>
(1987-12-11)</th>
<th>DM 1.1 EN</th>
<th>DM 1.2 EN</th>
<th>DM 1.2 GE</th>
<th>DM 1.3 FR</th>
<th>CSB 2.0 EN</th>
<th>CSB 2.1 EN</th>
</tr>
<tr class="odd">
<td rowspan="2">BOOTER</td>
<td rowspan="2">002</td>
<td>1024</td>
<td>1024</td>
<td>1024</td>
<td>1024</td>
<td>1024</td>
<td>1024</td>
<td>1024</td>
<td>1024</td>
</tr>
<tr class="odd">
<td>12-08-87<br>
12:34 pm</td>
<td>12-11-87<br>
11:52 am</td>
<td>07-01-88<br>
08:53 pm</td>
<td>31-12-99<br>
04:54 pm</td>
<td>31-12-99<br>
04:56 pm</td>
<td>20-11-85<br>
12:04 am</td>
<td>31-12-99<br>
04:54 pm</td>
<td>31-12-99<br>
04:54 pm</td>
</tr>
<tr class="even">
<td rowspan="2">SWOOSH.IMG</td>
<td rowspan="2">003-005</td>
<td>3016</td>
<td>3016</td>
<td>3016</td>
<td>3016</td>
<td>3016</td>
<td>3016</td>
<td>3016</td>
<td>3016</td>
</tr>
<tr class="even">
<td>12-08-87<br>
12:34 pm</td>
<td>12-11-87<br>
11:52 am</td>
<td>07-01-88<br>
08:54 pm</td>
<td>31-12-99<br>
04:54 pm</td>
<td>31-12-99<br>
04:56 pm</td>
<td>20-11-85<br>
12:04 am</td>
<td>31-12-99<br>
04:54 pm</td>
<td>31-12-99<br>
04:54 pm</td>
</tr>
<tr class="odd">
<td rowspan="2">START.PRG</td>
<td rowspan="2">006</td>
<td>770</td>
<td>770</td>
<td>770</td>
<td>770</td>
<td>770</td>
<td>770</td>
<td>770</td>
<td>770</td>
</tr>
<tr class="odd">
<td>12-08-87<br>
12:34 pm</td>
<td>12-11-87<br>
11:52 am</td>
<td>07-01-88<br>
08:54 pm</td>
<td>31-12-99<br>
04:55 pm</td>
<td>31-12-99<br>
04:56 pm</td>
<td>20-11-85<br>
12:04 am</td>
<td>31-12-99<br>
04:55 pm</td>
<td>31-12-99<br>
04:55 pm</td>
</tr>
<tr class="even">
<td rowspan="2">GRAPHICS.DAT</td>
<td rowspan="2">007-272</td>
<td>271911</td>
<td>271918</td>
<td>271917</td>
<td>271918</td>
<td>272288</td>
<td>271995</td>
<td>272069</td>
<td>272069</td>
</tr>
<tr class="even">
<td>12-08-87<br>
12:34 am</td>
<td>12-11-87<br>
02:51 pm</td>
<td>07-01-88<br>
09:01 pm</td>
<td>18-02-88<br>
12:18 am</td>
<td>01-03-88<br>
11:36 am</td>
<td>20-05-88<br>
06:03 pm</td>
<td>15-11-89<br>
12:00 am</td>
<td>15-11-89<br>
12:00 am</td>
</tr>
<tr class="odd">
<td rowspan="2">START.PAK</td>
<td rowspan="2">273-365 (DM)<br>
273-368 (CSB)<br>
372 (CSB 2.1)</td>
<td>95180</td>
<td>95226</td>
<td>95012</td>
<td>95148</td>
<td>95202</td>
<td>95208</td>
<td>97712</td>
<td>98516</td>
</tr>
<tr class="odd">
<td>12-08-87<br>
09:19 pm</td>
<td>12-11-87<br>
03:10 pm</td>
<td>08-01-88<br>
04:30 pm</td>
<td>24-02-88<br>
05:06 pm</td>
<td>24-02-88<br>
04:05 pm</td>
<td>20-05-88<br>
06:04 pm</td>
<td>15-11-89<br>
03:59 am</td>
<td>08-01-90<br>
01:25 pm</td>
</tr>
<tr class="even">
<td rowspan="2">DUNGEON.DAT</td>
<td rowspan="2">366-398 (DM)<br>
369-371 (CSB)</td>
<td>33286</td>
<td>33314</td>
<td>33442</td>
<td>33442</td>
<td>33792</td>
<td>33774</td>
<td>2098</td>
<td>2098</td>
</tr>
<tr class="even">
<td>12-08-87<br>
06:23 am</td>
<td>12-11-87<br>
02:10 pm</td>
<td>07-01-88<br>
08:47 pm</td>
<td>01-03-88<br>
11:04 am</td>
<td>01-03-88<br>
11:37 am</td>
<td>20-05-88<br>
06:05 pm</td>
<td>22-04-87<br>
04:17 am</td>
<td>22-04-87<br>
04:17 am</td>
</tr>
</tbody></table>
<p>Notes:</p>
<ul>
<li>These floppy disks were produced in 1987-1988, yet some files have their dates set to 31-12-99 or 20-11-85!</li>
<li>On the floppy disk of Dungeon Master for Atari ST version 1.0
English (1987-12-08), the root directory contains an additional entry
for a deleted file (a previous version of the START.PAK file):<br>
Name: &lt;$E5&gt;TART.PAK (the first character in the name being
replaced by the hexadecimal value $E5 means that the file was deleted)<br>
Size: 0 (all the clusters are used by other files)<br>
Date/Time: 12-08-87 09:19 pm</li>
<li>The SWOOSH.IMG file is identical on all the floppy disks listed in
the table above, as well as on the Chaos Strikes Back Utility Disk.</li>
<li>The START.PRG file is identical on all the floppy disks listed in
the table above, but different from the one found on the Chaos Strikes
Back Utility Disk.</li>
</ul>
<h4 id="toc61">Track 0, Sector 7: Serial number and protection with fuzzy bits</h4>
<h5>Serial number</h5>
<p>On all the floppy disks that have been studied in the making of this
document, there are three bytes that are different in each version,
making each copy of the games really <em>unique</em>. These unique
bytes probably form a serial number (because they are preceded by the
ASCII string 'Seri') and were probably included during disk duplication
when the games were manufactured in the hope that a pirated copy could
be more easily identified and located. These three bytes are located at
offsets $0D, $0E and $11. The bytes at offsets $0F and $10 may be part
of the serial number, but their values are always 00 00 in the disks
that were studied. Here are the values that were found (offsets $0D to
$11):</p>
<pre>9A 03 00 00 B4 Dungeon Master version 1.0 English (1987-12-08)
8F 09 00 00 AB Dungeon Master version 1.0 English (1987-12-11)
61 03 00 00 4F Dungeon Master version 1.1 English
81 04 00 00 48 Dungeon Master version 1.2 English
75 00 00 00 58 Dungeon Master version 1.2 English
CA 08 00 00 EF Dungeon Master version 1.2 English
24 12 00 00 1B Dungeon Master version 1.2 German
F7 09 00 00 D3 Dungeon Master version 1.3 French
AF 01 00 00 83 Dungeon Master version 1.3 French
3E 0E 00 00 1D Dungeon Master version 1.3 French
9A 03 00 00 B4 Chaos Strikes Back version 2.0 English
C9 04 00 00 E0 Chaos Strikes Back version 2.0 English
87 02 00 00 A8 Chaos Strikes Back version 2.0 English
35 00 00 00 18 Chaos Strikes Back version 2.1 English
CB 03 00 00 E5 Chaos Strikes Back version 2.1 English</pre><h5>Fuzzy bits</h5>
<p>This sector is most interesting because it contains 'fuzzy bits'. A
fuzzy bit is a bit whose value seems to be random: if you read the same
bit of data several times, the value will sometimes be '0' and it will
sometimes be '1'. There are several ways to create fuzzy bits on a
floppy disk and they all require the use of special hardware. The
floppy disk controller in the Atari ST cannot create them. This is the
reason why they are useful as a copy protection mechanism: if you try
to copy a sector containing fuzzy bits on a regular Atari ST, the
written data will not contain fuzzy bits anymore and will only reflect
the bits as they were read when the copy was made. The program can
check whether the floppy disk is an original by reading this sector
several times and comparing the results. If the value of some bits is
different across multiple read operations, then the disk is an
original. But if all read operations produce the same result, then the
disk is a copy.<br>
Using this method, it is fairly easy to write a program to detect fuzzy
bits. However with the standard FDC in the Atari ST it is not possible
to analyse how these fuzzy bits are produced: it is only possible to
detect the symptom (bits with random values) but not what causes them.</p>
<p>In order to find out how this works, DrCoolZic performed a very
detailed analysis of track 0 on the floppy disk. This was done on an
Atari ST equipped with a 'Discovery Cartridge' which is a hardware
add-on containing a much more advanced floppy disk controller than the
built-in one.</p>
<ol>
<li>Using the Discovery Cartridge, he made a complete recording of the
lowest possible level of information coming from the floppy disk: all
the flux reversals on track 0 including the accurate timing between
each pair of flux reversals. This high precision record represents the
output signal coming out from the floppy disk drive when reading the
track. This signal enters the floppy disk controller where the
electronics tries to extract meaningful information (the stream of data
bits) from the signal.</li>
<li>The recording was transfered to a PC where it was processed by an
'Analyze' program written by DrCoolZic. This program reproduces in
software the behavior of the standard Atari ST floppy disk controller
with high precision, including the PLL synchronization process.</li>
<li>A first analysis of the sector's content shows that there are no
MFM timing violations: consecutive flux reversals are always separated
by at least one 0 bit and at most three 0 bits.</li>
<li>A closer analysis of timings shows that some bit cells on the
floppy disk do not have normal sizes. This is what causes the fuzzy
bits.</li>
</ol>
<p>The MFM encoding ensures that between two bit cells containing flux
reversals (two '1' bits) there are at least one and at most three bit
cells without flux reversals ('0' bits). With the standard MFM bit cell
being 2µs, it means that two consecutive flux reversals can be spaced
only by 4µs, 6µs or 8µs. These three possible patterns are represented
on figure 2.<br>
Or course, depending on the drive speed and other factors, there can be
slight variations on these values. The role of the PLL in the FDC is to
constantly adapt the inspection window to these variations. The size of
the window is adjusted based on the frequency of the flux reversals
encountered in the input signal. The position of the window (also
called the phase) is adjusted so that flux reversals occur in the
middle of the inspection window. Only a few flux reversals are needed
for the PLL to be fully synchronized.<br>
When the PLL is synchronized, if a flux reversal is not correctly
placed and occurs at the very border of the inspection window (1µs
sooner or later than the 'perfect' expected timing), then the PLL gets
confused and outputs a random value:</p>
<ul>
<li>If the flux reversal is detected right before the end of the
inspection window, then the output bit will be '1'. The next bit will
be '0' because there cannot be two consecutive '1' bits.</li>
<li>If the flux reversal is not detected before the end of the
inspection window, then the output bit will be '0'. The flux reversal
will be detected at the very beginning of the next inspection window,
so that the next output bit will be '1'.</li>
</ul>
<p>Note that the misplaced flux reversal is never missed: the FDC just
cannot reliably determine which bit cell it is part of, hence the
random result.</p>
<p>In order to create this fuzzy bit effect, one way is to put flux
reversals right on the edge of the PLL's inspection window. For example
instead of the standard timings of 4µs or 6µs between two flux
reversals, an uncertain flux reversal could be written exactly 5µs
after the previous flux reversal. The PLL compensates for variations in
the disk rotation speed (it may be different from one drive to another
or from one rotation to the next), however smaller instantaneous
variations can occur during one rotation of the disk. These small
variations are responsible for the appearance of the fuzzy bits: the
uncertain flux reversals will not always be detected in the same bit
cell.<br>
In order to maximize the probability of having fuzzy bits detected, it
is possible to use some specific bit patterns. The pattern used in
Dungeon Master has some timing transitions that are slowly increasing
from values slightly below the size of the inspection window size to
values slightly above the size of the inspection window. For example it
could use transitions ranging from 4.70µs to 5.30µs in 0.05µs
increments.</p>
<p>Here is the sector data as it was most probably defined when being
written by the disk duplicator (this is only a guess, but it is
validated by the fact that the CRC value for this sector data matches
the one found on the original disk in the sector header field):</p>
<pre>Offset(h) 00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F

00000000  07 50 41 43 45 2F 46 42 09 53 65 72 69 CA 08 00  .PACE/FB.SeriÊ..
00000010  00 EF E9 01 68 68 68 68 68 68 68 68 68 68 68 68  .ïé.hhhhhhhhhhhh
00000020  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
00000030  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
00000040  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
00000050  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
00000060  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
00000070  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
00000080  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
00000090  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
000000A0  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
000000B0  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
000000C0  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
000000D0  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
000000E0  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
000000F0  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
00000100  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
00000110  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
00000120  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
00000130  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
00000140  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
00000150  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
00000160  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
00000170  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
00000180  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
00000190  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
000001A0  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
000001B0  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
000001C0  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
000001D0  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
000001E0  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
000001F0  68 68 68 68 68 68 68 68 68 68 68 68 68 AC 46 42  hhhhhhhhhhhhh¬FB</pre><p>
Note that the duplicator needed additional information about the exact
timings to use to record this sector, instead of using the standard
timings. The use of carefully chosen custom timings while writing this
sector is the real cause of the fuzzy bits. Look at the sector data as
it is read from the floppy disk (this is only one example: each read
operation would return a slightly different result because of the fuzzy
bits producing random values):</p>
<pre>Offset(h) 00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F

00000000  07 50 41 43 45 2f 46 42 09 53 65 72 69 ca 08 00  .PACE/FB.Seri...
00000010  00 ef e9 01 68 68 68 68 68 68 68 68 68 68 e8 e8  ....hhhhhhhhhh..
00000020  e8 e8 e8 e8 e8 e8 e8 e8 e8 68 68 68 68 68 68 68  .........hhhhhhh
00000030  68 68 68 68 68 68 68 68 68 68 68 68 e8 e8 e8 e8  hhhhhhhhhhhh....
00000040  e8 e8 e8 e8 e8 e8 e8 68 68 68 68 68 68 68 68 68  .......hhhhhhhhh
00000050  68 68 68 68 68 68 68 68 68 68 e8 e8 68 e8 e8 e8  hhhhhhhhhh..h...
00000060  e8 e8 e8 e8 e8 e8 68 68 68 68 68 68 68 68 68 68  ......hhhhhhhhhh
00000070  68 68 68 68 68 68 68 68 e8 e8 68 e8 e8 e8 e8 e8  hhhhhhhh..h.....
00000080  e8 68 e8 e8 e8 68 68 68 68 68 68 68 68 68 68 68  .h...hhhhhhhhhhh
00000090  68 68 68 68 68 68 e8 e8 68 e8 e8 e8 e8 e8 e8 e8  hhhhhh..h.......
000000A0  e8 68 68 e8 68 68 68 68 68 68 68 68 68 68 68 68  .hh.hhhhhhhhhhhh
000000B0  68 68 68 68 68 68 e8 e8 e8 e8 e8 e8 e8 e8 e8 68  hhhhhh.........h
000000C0  68 e8 68 68 68 68 68 68 68 68 68 68 68 68 68 68  h.hhhhhhhhhhhhhh
000000D0  68 e8 68 68 e8 e8 e8 e8 e8 e8 e8 e8 e8 e8 68 68  h.hh..........hh
000000E0  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68  hhhhhhhhhhhhhhhh
000000F0  e8 e8 e8 e8 e8 e8 e8 e8 e8 e8 68 68 e8 68 68 68  ..........hh.hhh
00000100  68 68 68 68 68 68 68 68 68 68 68 68 68 e8 e8 e8  hhhhhhhhhhhhh...
00000110  68 e8 e8 e8 e8 e8 e8 e8 68 68 e8 68 68 68 68 68  h.......hh.hhhhh
00000120  68 68 68 68 68 68 68 68 68 68 68 68 e8 e8 e8 68  hhhhhhhhhhhh...h
00000130  e8 e8 e8 e8 e8 e8 e8 e8 68 68 68 68 68 68 68 68  ........hhhhhhhh
00000140  68 68 68 68 68 68 68 68 68 68 68 e8 e8 68 e8 e8  hhhhhhhhhhh..h..
00000150  e8 e8 e8 e8 e8 e8 68 68 68 68 68 68 68 68 68 68  ......hhhhhhhhhh
00000160  68 68 68 68 68 68 68 e8 68 68 e8 e8 e8 e8 e8 e8  hhhhhhh.hh......
00000170  e8 e8 68 68 e8 68 68 68 68 68 68 68 68 68 68 68  ..hh.hhhhhhhhhhh
00000180  68 68 68 68 68 e8 68 68 e8 e8 e8 e8 e8 e8 e8 e8  hhhhh.hh........
00000190  68 68 e8 68 68 68 68 68 68 68 68 68 68 68 68 68  hh.hhhhhhhhhhhhh
000001A0  68 68 68 68 68 68 e8 e8 e8 e8 e8 e8 e8 e8 68 68  hhhhhh........hh
000001B0  e8 e8 68 68 68 68 68 68 68 68 68 68 68 68 68 68  ..hhhhhhhhhhhhhh
000001C0  68 e8 e8 68 68 e8 e8 e8 e8 e8 e8 e8 68 68 e8 68  h..hh.......hh.h
000001D0  68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 e8  hhhhhhhhhhhhhhh.
000001E0  e8 68 e8 e8 e8 e8 e8 e8 e8 e8 e8 e8 e8 68 68 68  .h...........hhh
000001F0  68 68 68 68 68 68 68 68 68 68 68 68 68 ac 46 42  hhhhhhhhhhhhh.FB</pre><p>
As you can see, many 68h bytes have been transformed to E8h bytes. Here is what happens at binary level:<br>
Two consecutive 68h bytes, along with their MFM representation:</p>
<pre>    0 1 1 0 1 0 0 0  0 1 1 0 1 0 0 0
MFM 001010001001010<strong><em>1 0</em></strong>010100010010101</pre><p>When
the fuzzy bit effect takes place, the clock bit between the two bytes
of data and the first data bit of the second byte are swapped:</p>
<pre>    0 1 1 0 1 0 0 0  1 1 1 0 1 0 0 0
MFM 001010001001010<strong><em>0 1</em></strong>010100010010101</pre><p>The hexadecimal value of the second byte then becomes E8h.</p>
<h4 id="toc82">Track 0, Sector 247: Protection with a non standard sector number</h4>
<p>This sector is identical in all versions of Dungeon Master and Chaos Strikes Back for Atari ST.<br>
In the sector header field of the eighth sector of track 0, the sector
number specified is 247 ($F7) instead of the expected value 8.<br>
Having a sector number which is not in line with other sectors is not a
problem by itself. This sector can be read as any other sector as long
as you give the FDC the correct sector number to read, which is 247.
This may cause trouble to many programs because they will try to read
sectors numbered from 1 to 10 and they will fail in reading sector
number 8 because there is no such sector on the track. It is also quite
easy to write a sector with pretty much any number while formating the
track (writing the whole track at once). However, $F7 (and a few other
values) is a sector number that cannot be written by the standard
floppy disk controller in the Atari ST computer. This value is
interpreted as a special command by the FDC when it formats the track
and thus this value cannot be written to the disk in a sector header
field. It means that a disk copy made on a standard Atari ST cannot
have this value correctly copied. Only special equipment can be used to
write this value in the sector header. This provides a copy protection
mechanism as it cannot be reproduced on a standard Atari ST computer.</p>
<p>There is nothing special with the contents of this sector data
field. The protection relies only on the special sector number in the
header field.<br>
Here is an hexadecimal dump of the data in this sector:</p>
<pre>Offset(h) 00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F

00000000  43 6F 70 79 72 69 67 68 74 20 28 63 29 20 31 39  Copyright (c) 19
00000010  38 37 2C 20 53 6F 66 74 77 61 72 65 20 48 65 61  87, Software Hea
00000020  76 65 6E 2C 20 49 6E 63 2E 00 FF FF FF FF FF FF  ven, Inc..ÿÿÿÿÿÿ
00000030  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
00000040  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
00000050  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
00000060  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
00000070  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
00000080  44 75 6E 67 65 6F 6E 4D 61 73 74 65 72 00 FF FF  DungeonMaster.ÿÿ
00000090  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
000000A0  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
000000B0  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
000000C0  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
000000D0  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
000000E0  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
000000F0  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
00000100  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
00000110  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
00000120  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
00000130  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
00000140  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
00000150  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
00000160  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
00000170  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
00000180  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
00000190  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
000001A0  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
000001B0  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
000001C0  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
000001D0  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
000001E0  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ
000001F0  FF FF FF FF FF FF FF FF FF FF FF FF FF FF 9C 9C  ÿÿÿÿÿÿÿÿÿÿÿÿÿÿœœ</pre><h3 id="toc86">Description of the boot process</h3>
<ol>
<li>The Atari ST BIOS loads the boot sector from the floppy disk to memory.</li>
<li>After checking that the boot sector is executable (by computing a checksum), the boot sector code is executed.</li>
<li>The boot sector code loads the SWOOSH.IMG file in memory and starts execution of this program.</li>
<li>SWOOSH.IMG displays the FTL logo (using a palette animation
technique to simulate the logo animation) and plays the associated
sound effect by using the Programmable Sound Generator (PSG). It then
makes a BIOS call to run START.PRG with the 'AUTO' command line
parameter. The program will not start without this parameter, this is
another simple protection.</li>
<li>START.PRG is a small program that reads the compressed main program
from the START.PAK file and uncompresses it to memory. The main
program, which follows the standard Atari ST .PRG format, is then
executed from memory.</li>
</ol>
<h3 id="toc88">References</h3>
<dl>
<dt><a href="http://dmweb.free.fr/files/Atari_Copy_Protection_V0.8.pdf" class="file-pdf" title="Atari_Copy_Protection_V0.8.pdf"><img src="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/IconPDF.png" alt="Atari_Copy_Protection_V0.8.pdf" height="16" width="16"> Atari_Copy_Protection_V0.8.pdf</a></dt>
<dd>This document by DrCoolZic describes all the copy protection
schemes that were used on Atari ST. Its content about Dungeon Master
was the basis for this web page. It also describes the custom tools
written by the author to analyze the copy protections.</dd>
<dt><a href="http://dmweb.free.fr/files/TechDoc-DM-AtariST-FloppyDiskAnalysis.zip" class="file-archive" title="TechDoc-DM-AtariST-FloppyDiskAnalysis.zip"><img src="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/IconArchive.png" alt="TechDoc-DM-AtariST-FloppyDiskAnalysis.zip" height="16" width="16"> TechDoc-DM-AtariST-FloppyDiskAnalysis.zip</a></dt>
<dd>This archive contains the complete results of DrCoolZic's tools
when run against a floppy disk of Dungeon Master for Atari ST version
1.2 English. These files were kindly produced for me by DrCoolZic.
Please read the PDF document above to better understand their contents.</dd>
</dl>
<h3 id="toc90">Credits</h3>
<p>Jean Louis-Guérin (DrCoolZic) for his detailed analysis of the
original floppy disk as shown in his great document about the many copy
protection schemes that were used by Atari ST games, and for the help
he gave me in writing this article.</p>
<h3 id="toc92">History of this document</h3>
<dl>
<dt>Version 1.1, February 14, 2009</dt>
<dd>Minor edits.</dd>
<dd>The Fuzzy Bits section was updated with a better explanation. Thanks to Jean Louis-Guérin for his help.</dd>
<dt>Version 1.0, January 25, 2009</dt>
<dd>First release.</dd>
</dl>
  </div>

  <div class="clear-block">
    <div class="meta">
          <div class="terms"><ul class="links inline"><li class="taxonomy_term_20 first"><a href="http://dmweb.free.fr/?q=taxonomy/term/20" rel="tag" title="">Atari ST</a></li>
<li class="taxonomy_term_22"><a href="http://dmweb.free.fr/?q=taxonomy/term/22" rel="tag" title="">Chaos Strikes Back</a></li>
<li class="taxonomy_term_17"><a href="http://dmweb.free.fr/?q=taxonomy/term/17" rel="tag" title="">Dungeon Master</a></li>
<li class="taxonomy_term_39 last"><a href="http://dmweb.free.fr/?q=taxonomy/term/39" rel="tag" title="">Technical Documentation</a></li>
</ul></div>
        </div>

          <div class="links"><ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>
      </div>

</div>
          </div>
                    <div id="footer"></div>
          <hr>
<p><a href="http://www.drupal.org/" title="Drupal - Community plumbing"><img src="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/powered-blue-80x15.png" alt="Powered by Drupal" height="15" width="80"></a>&nbsp;
<a href="http://www.xiti.com/xiti.asp?s=76739" title="Xiti audience measurement">
<script type="text/javascript">
<!--
Xt_param = '';
try {Xt_r = top.document.referrer;}
catch(e) {Xt_r = document.referrer; }
Xt_h = new Date();
Xt_i = '<img width="80" height="15" alt="Xiti audience measurement" src="http://logv18.xiti.com/bcg.xiti?s=76739&p=&hl='+Xt_h.getHours()+'x'+Xt_h.getMinutes()+'x'+Xt_h.getSeconds();
if(parseFloat(navigator.appVersion)>=4)
{Xt_s=screen;Xt_i+='&r='+Xt_s.width+'x'+Xt_s.height+'x'+Xt_s.pixelDepth+'x'+Xt_s.colorDepth;}
document.write(Xt_i+'&ref='+Xt_r.replace(/[<>"]/g, '').replace(/&/g, '$')+'" title="Xiti audience measurement">');
//-->
</script><img alt="Xiti audience measurement" src="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/bcg.gif" title="Xiti audience measurement" height="15" width="80">
<object>
<noscript>
<div><img width="80" height="15"
src="http://logv18.xiti.com/bcg.xiti?s=76739&amp;p=&amp;" alt="Xiti
audience measurement" title="Xiti audience measurement" /></div>
</noscript>
</object>
</a>
&nbsp;<a href="http://validator.w3.org/check?uri=referer" title="Valid XHTML 1.0 Strict"><img src="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/xhtml10.png" alt="Valid XHTML 1.0 Strict" height="15" width="80"></a>
</p>
      </div></div></div></div> <!-- /.left-corner, /.right-corner, /#squeeze, /#center -->

      
    </div> <!-- /container -->
  </div>
<!-- /layout -->

    <div id="overlay" style="display: none;"></div>      <div id="lightbox" style="display: none;">        <div style="background-color: rgb(158, 158, 158); color: rgb(0, 0, 0);" id="outerImageContainer"><div id="modalContainer" style="padding: 10px; display: none;"></div><div id="frameContainer" style="padding: 10px; display: none;"></div><div id="imageContainer" style="padding: 10px; display: none;"><img id="lightboxImage"><div id="hoverNav"><a style="padding-top: 10px;" id="prevLink" href="#"></a><a style="padding-top: 10px;" id="nextLink" href="#"></a></div></div><div id="loading"><a href="#" id="loadingLink"></a></div></div>        <div style="background-color: rgb(158, 158, 158); color: rgb(0, 0, 0);" id="imageDataContainer" class="clearfix">          <div id="imageData"><div id="frameHoverNav"><a style="padding-top: 10px;" id="framePrevLink" href="#"></a><a style="padding-top: 10px;" id="frameNextLink" href="#"></a></div><div id="imageDetails"><span id="caption"></span><span id="numberDisplay"></span></div><div id="bottomNav"><a style="background-color: rgb(158, 158, 158); color: rgb(0, 0, 0);" id="bottomNavClose" href="#"></a><a id="bottomNavZoom" href="#"></a><a id="bottomNavZoomOut" href="#"></a><a id="lightshowPause" href="#" style="display: none;"></a><a id="lightshowPlay" href="#" style="display: none;"></a></div></div>        </div>      </div><div style="position: fixed; width: 8px; height: 8px; bottom: 0px; left: 0px; z-index: -1;" class="movieContainer" id="sm2-container"><embed name="sm2movie" id="sm2movie" src="Technical%20Documentation%20-%20Detailed%20analysis%20of%20the%20Dungeon%20Master%20and%20Chaos%20Strikes%20Back%20for%20Atari%20ST%20Floppy%20Disks%20_%20Dungeon%20Master%20Encyclopaedia_fichiers/soundmanager2.swf" allowscriptaccess="always" quality="high" wmode="transparent" bgcolor="#ffffff" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" height="100%" width="100%"></div></body></html>